<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Buzzer - Multi Team</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .setup-panel, .join-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .panel-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        .setup-row {
            display: flex;
            gap: 20px;
            align-items: end;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            text-align: left;
        }

        .input-group label {
            font-weight: 600;
            color: #333;
        }

        .input-group input {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e1e5e9;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .team-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 3px solid transparent;
        }

        .team-card.connected {
            border-color: #48bb78;
        }

        .team-card.winner {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            transform: scale(1.05);
            animation: pulse 1s infinite alternate;
            border-color: #fff;
        }

        .team-card.fastest {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            color: #333;
            border-color: #ffd700;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .team-card.fastest .team-name {
            color: #333;
        }

        .team-card.fastest .team-time {
            color: #333;
        }

        @keyframes pulse {
            from { box-shadow: 0 4px 20px rgba(72, 187, 120, 0.4); }
            to { box-shadow: 0 8px 30px rgba(72, 187, 120, 0.6); }
        }

        .team-name {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }

        .team-card.winner .team-name,
        .team-card.connected .team-name {
            color: white;
        }

        .team-card.connected .team-name {
            color: #48bb78;
        }

        .team-card.winner .team-name {
            color: white;
        }

        .team-status {
            font-size: 1.1em;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .team-time {
            font-size: 2em;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            color: #667eea;
        }

        .team-card.winner .team-time {
            color: white;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .status-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .status-display h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .winner-announcement {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            font-size: 1.3em;
            font-weight: 600;
        }

        .connection-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .connection-info h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .room-code {
            font-size: 2em;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            color: #667eea;
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            margin: 10px 0;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .instructions h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions ul {
            color: #555;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .hidden {
            display: none;
        }

        .buzzer-button {
            width: 100%;
            height: 150px;
            font-size: 2em;
            font-weight: 800;
            border-radius: 20px;
            margin-top: 20px;
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .buzzer-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(245, 101, 101, 0.4);
        }

        .buzzer-button:active {
            transform: scale(0.95);
        }

        .buzzer-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .setup-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .input-group input {
                min-width: auto;
            }
            
            .teams-grid {
                grid-template-columns: 1fr;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Quiz Buzzer</h1>
            <p>Real-time multi-team buzzer system</p>
        </div>

        <!-- Host Setup Panel -->
        <div id="hostPanel" class="setup-panel">
            <div class="panel-title">üéØ Host a Game</div>
            <div class="setup-row">
                <div class="input-group">
                    <label for="teamCount">Number of Teams (2-10)</label>
                    <input type="number" id="teamCount" min="2" max="10" value="4">
                </div>
                <button class="btn btn-primary" onclick="hostGame()">Create Game Room</button>
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="showJoinPanel()">Join Existing Game</button>
            </div>
        </div>

        <!-- Join Game Panel -->
        <div id="joinPanel" class="join-panel hidden">
            <div class="panel-title">üîó Join a Game</div>
            <div class="setup-row">
                <div class="input-group">
                    <label for="roomCode">Room Code</label>
                    <input type="text" id="roomCode" placeholder="Enter room code" maxlength="6" style="text-transform: uppercase;">
                </div>
                <div class="input-group">
                    <label for="teamName">Your Team Name</label>
                    <input type="text" id="teamName" placeholder="Enter team name">
                </div>
                <button class="btn btn-success" onclick="joinGame()">Join Game</button>
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="showHostPanel()">Back to Host</button>
            </div>
        </div>

        <!-- Game Panel -->
        <div id="gamePanel" class="hidden">
            <div class="connection-info" id="connectionInfo">
                <h3>üéÆ Game Room</h3>
                <div>Room Code: <span class="room-code" id="displayRoomCode"></span></div>
                <div id="shareLink" style="margin-top: 10px;">
                    <small>Share this link: <span id="gameLinkText" style="color: #667eea;"></span></small>
                    <button class="btn btn-secondary" onclick="copyGameLink()" style="margin-left: 10px; padding: 5px 10px; font-size: 12px;">Copy</button>
                </div>
            </div>

            <div class="status-display">
                <h2 id="gameStatus">Setting up game...</h2>
            </div>

            <div class="game-controls" id="hostControls">
                <button class="btn btn-primary" onclick="startRound()">Start New Round</button>
                <button class="btn btn-secondary" onclick="resetGame()">Reset Game</button>
            </div>

            <div id="teamsGrid" class="teams-grid">
                <!-- Team cards will be generated here -->
            </div>

            <!-- Player Buzzer Button (only visible to joined players) -->
            <div id="playerControls" class="hidden">
                <button class="buzzer-button" id="buzzerBtn" onclick="buzz()" disabled>
                    üî¥ BUZZ IN!
                </button>
            </div>
        </div>

        <div class="instructions">
            <h3>üìã How to Play</h3>
            <ul>
                <li><strong>Host:</strong> Create a game room and share the room code with teams</li>
                <li><strong>Join:</strong> Each team joins using the room code and their team name</li>
                <li><strong>Start:</strong> Host clicks "Start New Round" to activate buzzers</li>
                <li><strong>Buzz:</strong> Teams click the red buzzer button or press SPACEBAR</li>
                <li><strong>Winner:</strong> First team to buzz wins the round with precise timing</li>
                <li><strong>Continue:</strong> Host starts new rounds or resets the game</li>
            </ul>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            isHost: false,
            roomCode: '',
            teams: [],
            connectedTeams: new Map(),
            gameActive: false,
            startTime: 0,
            winner: null,
            roundNumber: 0,
            myTeamName: '',
            eventSource: null
        };

        // Simple room storage (in production, use a proper backend)
        const STORAGE_KEY = 'quiz-buzzer-rooms';

        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function saveRoomData(roomCode, data) {
            const rooms = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            rooms[roomCode] = { ...data, lastUpdated: Date.now() };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(rooms));
        }

        function getRoomData(roomCode) {
            const rooms = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            return rooms[roomCode] || null;
        }

        function broadcastToRoom(roomCode, message) {
            const event = new CustomEvent('roomMessage', {
                detail: { roomCode, message }
            });
            window.dispatchEvent(event);
        }

        function hostGame() {
            const teamCount = parseInt(document.getElementById('teamCount').value);
            if (teamCount < 2 || teamCount > 10) {
                alert('Please enter a number between 2 and 10');
                return;
            }

            gameState.isHost = true;
            gameState.roomCode = generateRoomCode();
            gameState.teams = [];

            // Create empty team slots
            for (let i = 0; i < teamCount; i++) {
                gameState.teams.push({
                    id: i + 1,
                    name: `Team ${i + 1}`,
                    connected: false,
                    time: null,
                    isWinner: false
                });
            }

            saveRoomData(gameState.roomCode, {
                teams: gameState.teams,
                gameActive: false,
                hostPresent: true
            });

            showGamePanel();
            updateGameStatus('Waiting for teams to join...');
            startListening();
        }

        function showJoinPanel() {
            document.getElementById('hostPanel').classList.add('hidden');
            document.getElementById('joinPanel').classList.remove('hidden');
        }

        function showHostPanel() {
            document.getElementById('joinPanel').classList.add('hidden');
            document.getElementById('hostPanel').classList.remove('hidden');
        }

        function joinGame() {
            const roomCode = document.getElementById('roomCode').value.toUpperCase().trim();
            const teamName = document.getElementById('teamName').value.trim();

            if (!roomCode || !teamName) {
                alert('Please enter both room code and team name');
                return;
            }

            const roomData = getRoomData(roomCode);
            if (!roomData) {
                alert('Room not found! Please check the room code.');
                return;
            }

            // Find an available team slot
            const availableTeam = roomData.teams.find(team => !team.connected);
            if (!availableTeam) {
                alert('This game room is full!');
                return;
            }

            gameState.isHost = false;
            gameState.roomCode = roomCode;
            gameState.myTeamName = teamName;
            gameState.teams = roomData.teams;

            // Update team name and mark as connected
            availableTeam.name = teamName;
            availableTeam.connected = true;

            saveRoomData(roomCode, {
                teams: gameState.teams,
                gameActive: roomData.gameActive,
                hostPresent: roomData.hostPresent
            });

            broadcastToRoom(roomCode, { type: 'teamJoined', team: availableTeam });

            showGamePanel();
            updateGameStatus('Connected! Waiting for host to start the round...');
            startListening();
        }

        function showGamePanel() {
            document.getElementById('hostPanel').classList.add('hidden');
            document.getElementById('joinPanel').classList.add('hidden');
            document.getElementById('gamePanel').classList.remove('hidden');

            document.getElementById('displayRoomCode').textContent = gameState.roomCode;
            
            const gameLink = window.location.href.split('?')[0] + '?room=' + gameState.roomCode;
            document.getElementById('gameLinkText').textContent = gameLink;

            if (gameState.isHost) {
                document.getElementById('hostControls').classList.remove('hidden');
                document.getElementById('playerControls').classList.add('hidden');
            } else {
                document.getElementById('hostControls').classList.add('hidden');
                document.getElementById('playerControls').classList.remove('hidden');
            }

            renderTeams();
        }

        function startListening() {
            // Listen for room updates
            window.addEventListener('roomMessage', (event) => {
                const { roomCode, message } = event.detail;
                if (roomCode === gameState.roomCode) {
                    handleRoomMessage(message);
                }
            });

            // Poll for updates (simple implementation)
            setInterval(() => {
                const roomData = getRoomData(gameState.roomCode);
                if (roomData) {
                    // Store previous state
                    const wasGameActive = gameState.gameActive;
                    const oldRoundNumber = gameState.roundNumber;
                    
                    // Update teams data
                    gameState.teams = roomData.teams;
                    
                    // Check for round changes
                    if (roomData.roundNumber && roomData.roundNumber !== oldRoundNumber) {
                        gameState.roundNumber = roomData.roundNumber;
                    }
                    
                    // Check if round started
                    if (roomData.gameActive && !wasGameActive) {
                        gameState.gameActive = true;
                        gameState.startTime = roomData.startTime || Date.now();
                        
                        if (!gameState.isHost) {
                            updateGameStatus(`Round ${gameState.roundNumber} - üö® BUZZ IN NOW!`);
                            
                            const buzzerBtn = document.getElementById('buzzerBtn');
                            if (buzzerBtn) {
                                buzzerBtn.disabled = false;
                                buzzerBtn.textContent = 'üî¥ BUZZ IN!';
                            }
                        }
                    }
                    
                    // Check if round ended
                    if (!roomData.gameActive && wasGameActive) {
                        gameState.gameActive = false;
                        
                        const buzzerBtn = document.getElementById('buzzerBtn');
                        if (buzzerBtn) {
                            buzzerBtn.disabled = true;
                            buzzerBtn.textContent = '‚è±Ô∏è ROUND ENDED';
                        }
                    }
                    
                    renderTeams();
                }
            }, 200);
        }

        function handleRoomMessage(message) {
            console.log('Received room message:', message);
            
            switch (message.type) {
                case 'teamJoined':
                    if (gameState.isHost) {
                        updateGameStatus(`${message.team.name} joined the game!`);
                        renderTeams();
                    }
                    break;
                case 'roundStarted':
                    if (!gameState.isHost) {
                        console.log('Round started message received by player');
                        gameState.gameActive = true;
                        gameState.roundNumber = message.roundNumber || gameState.roundNumber + 1;
                        gameState.startTime = message.startTime || Date.now();
                        
                        // Reset local team states
                        gameState.teams.forEach(team => {
                            team.time = null;
                            team.isWinner = false;
                        });
                        
                        updateGameStatus(`Round ${gameState.roundNumber} - üö® BUZZ IN NOW!`);
                        
                        const buzzerBtn = document.getElementById('buzzerBtn');
                        if (buzzerBtn) {
                            buzzerBtn.disabled = false;
                            buzzerBtn.textContent = 'üî¥ BUZZ IN!';
                        }
                        
                        renderTeams();
                    }
                    break;
                case 'teamBuzzed':
                    if (gameState.isHost && gameState.gameActive) {
                        console.log('Team buzzed:', message.team.name, message.time);
                        handleBuzzerPress(message.team, message.time);
                    }
                    break;
            }
        }

        function startRound() {
            if (!gameState.isHost) return;

            const connectedTeams = gameState.teams.filter(team => team.connected);
            if (connectedTeams.length < 2) {
                alert('Need at least 2 teams connected to start a round!');
                return;
            }

            // Reset game state
            gameState.roundNumber++;
            gameState.gameActive = true;
            gameState.winner = null;
            gameState.startTime = Date.now();
            
            // Reset all team states
            gameState.teams.forEach(team => {
                team.time = null;
                team.isWinner = false;
            });

            // Update room data immediately
            const roomData = getRoomData(gameState.roomCode);
            if (roomData) {
                roomData.gameActive = true;
                roomData.roundNumber = gameState.roundNumber;
                roomData.startTime = gameState.startTime;
                
                // Reset all teams in room data
                roomData.teams.forEach(team => {
                    team.time = null;
                    team.isWinner = false;
                });
                
                saveRoomData(gameState.roomCode, roomData);
            }

            updateGameStatus(`Round ${gameState.roundNumber} - Get Ready... BUZZ IN NOW! üö®`);
            
            // Broadcast to all connected devices
            broadcastToRoom(gameState.roomCode, { 
                type: 'roundStarted', 
                roundNumber: gameState.roundNumber,
                startTime: gameState.startTime
            });
            
            renderTeams();
            
            console.log('Round started:', gameState.roundNumber, 'Active:', gameState.gameActive);
        }

        function buzz() {
            if (!gameState.gameActive || !gameState.myTeamName) return;

            const reactionTime = Date.now() - gameState.startTime;
            const myTeam = gameState.teams.find(team => team.name === gameState.myTeamName);
            
            if (myTeam && !myTeam.time) {
                // Update local state immediately
                myTeam.time = reactionTime;
                
                // Disable buzzer button
                const buzzerBtn = document.getElementById('buzzerBtn');
                if (buzzerBtn) {
                    buzzerBtn.disabled = true;
                    buzzerBtn.textContent = '‚è±Ô∏è BUZZED!';
                }
                
                // Update room data
                const roomData = getRoomData(gameState.roomCode);
                if (roomData) {
                    const teamToUpdate = roomData.teams.find(t => t.name === gameState.myTeamName);
                    if (teamToUpdate) {
                        teamToUpdate.time = reactionTime;
                    }
                    saveRoomData(gameState.roomCode, roomData);
                }
                
                broadcastToRoom(gameState.roomCode, {
                    type: 'teamBuzzed',
                    team: myTeam,
                    time: reactionTime
                });
                
                renderTeams();
            }
        }

        function handleBuzzerPress(team, reactionTime) {
            if (!gameState.gameActive || gameState.winner) return;

            // Find the team in our gameState and update it
            const teamToUpdate = gameState.teams.find(t => t.name === team.name);
            if (teamToUpdate) {
                teamToUpdate.time = reactionTime;
                
                // First team to buzz becomes the winner
                if (!gameState.winner) {
                    teamToUpdate.isWinner = true;
                    gameState.winner = teamToUpdate;
                    gameState.gameActive = false;

                    const roomData = getRoomData(gameState.roomCode);
                    roomData.gameActive = false;
                    roomData.teams = gameState.teams;
                    saveRoomData(gameState.roomCode, roomData);

                    updateGameStatus(`üéâ ${teamToUpdate.name} wins with ${reactionTime}ms reaction time!`);
                } else {
                    // Update room data for subsequent buzzes
                    const roomData = getRoomData(gameState.roomCode);
                    const roomTeam = roomData.teams.find(t => t.name === team.name);
                    if (roomTeam) {
                        roomTeam.time = reactionTime;
                        saveRoomData(gameState.roomCode, roomData);
                    }
                }
                
                renderTeams();
            }
        }

        function renderTeams() {
            const teamsGrid = document.getElementById('teamsGrid');
            teamsGrid.innerHTML = '';

            // Create a copy of teams for sorting without modifying original
            let sortedTeams = [...gameState.teams];

            // Sort teams: buzzed teams first (by time), then non-buzzed teams
            sortedTeams.sort((a, b) => {
                // If both have times, sort by time (ascending - fastest first)
                if (a.time !== null && b.time !== null) {
                    return a.time - b.time;
                }
                // If only one has time, it goes first
                if (a.time !== null) return -1;
                if (b.time !== null) return 1;
                // If neither has time, sort by original order (id)
                return a.id - b.id;
            });

            // Find the fastest team (lowest time among teams that buzzed)
            const buzzerTeams = sortedTeams.filter(team => team.time !== null);
            const fastestTime = buzzerTeams.length > 0 ? Math.min(...buzzerTeams.map(t => t.time)) : null;

            sortedTeams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                
                // Determine card classes
                let cardClasses = 'team-card';
                if (team.isWinner) cardClasses += ' winner';
                if (team.connected) cardClasses += ' connected';
                if (team.time !== null && team.time === fastestTime) cardClasses += ' fastest';
                
                teamCard.className = cardClasses;
                
                const statusText = team.connected 
                    ? (team.time !== null ? `Buzzed! ${team.time === fastestTime ? 'üèÜ FASTEST' : ''}` : 'Ready') 
                    : 'Waiting to join...';
                
                // Add position indicator for buzzed teams
                const positionText = team.time !== null ? `#${index + 1}` : '';
                
                teamCard.innerHTML = `
                    <div class="team-name">${team.name} ${positionText}</div>
                    <div class="team-status">${statusText}</div>
                    <div class="team-time">${team.time !== null ? team.time + 'ms' : '--'}</div>
                `;
                teamsGrid.appendChild(teamCard);
            });
        }

        function resetGame() {
            if (!gameState.isHost) return;

            gameState = {
                isHost: false,
                roomCode: '',
                teams: [],
                connectedTeams: new Map(),
                gameActive: false,
                startTime: 0,
                winner: null,
                roundNumber: 0,
                myTeamName: ''
            };
            
            document.getElementById('hostPanel').classList.remove('hidden');
            document.getElementById('gamePanel').classList.add('hidden');
            document.getElementById('teamCount').value = 4;
        }

        function updateGameStatus(message) {
            const statusElement = document.getElementById('gameStatus');
            statusElement.textContent = message;
            
            if (message.includes('wins')) {
                statusElement.parentElement.className = 'status-display winner-announcement';
            } else {
                statusElement.parentElement.className = 'status-display';
            }
        }

        function copyGameLink() {
            const link = document.getElementById('gameLinkText').textContent;
            navigator.clipboard.then(() => {
                navigator.clipboard.writeText(link);
                alert('Game link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Game link copied to clipboard!');
            });
        }

        // Global spacebar listener for buzzer
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space' && !gameState.isHost && gameState.gameActive && gameState.myTeamName) {
                event.preventDefault();
                buzz();
            }
        });

        // Prevent spacebar from scrolling
        window.addEventListener('keydown', function(e) {
            if(e.keyCode === 32 && e.target === document.body) {
                e.preventDefault();
            }
        });

        // Check for room code in URL
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomCode = urlParams.get('room');
            if (roomCode) {
                document.getElementById('roomCode').value = roomCode;
                showJoinPanel();
            }
        });

        // Clean up old rooms on load
        window.addEventListener('load', function() {
            const rooms = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const now = Date.now();
            const cleanRooms = {};
            
            Object.keys(rooms).forEach(code => {
                if (now - rooms[code].lastUpdated < 24 * 60 * 60 * 1000) { // Keep for 24 hours
                    cleanRooms[code] = rooms[code];
                }
            });
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(cleanRooms));
        });
    </script>
</body>
</html>
